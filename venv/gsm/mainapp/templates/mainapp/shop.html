{%extends 'base.html'%}
{%load static%}
{%block content%}

<style>
  
    #side-bar{
        border-radius: 5px;
    }
     #shop-nav-1{
        border-radius: 5px;
    }
     #shop-nav-2{
        border-radius: 5px;
    }
    #shop-title{
        background-image: url("{%static 'shop-bg-title.jpeg'%}");
        border-radius: 5px;
    }
    #filter-bar{
        padding-bottom: 20px;
        background-color: #091D34;
        color: white;
    }
    .selected{
        display: inline-block;
    }
    .condition-selected{
        display: inline-block;
    }
</style>
<div class="align-self-center mt-3 container d-flex flex-column">
    
    <div class="d-flex flex-wrap" >
            <div class="flex-grow-1 m-3 flex-fill d-flex" id="shop-title">
                <div class="d-flex mt-3 flex-fill justify-content-center align-items-center pt-5 pb-5" id="shop-nav-2">
                    <h1 class="text-center text-white">Produse disponibile in magazin</h1>
                </div>
            </div>
    </div>
   

        <!--Grid row-->
        <div class="row m-3 d-flex flex-column  bg-white" style="border-radius: 5px;">
            
            <div class="row ml-0" id="filter-bar">
                <div class="col-lg-4 col-sm-12 mt-3 col-md-12" id="form">
                    <h4 class="mt-3 ml-5" style="border-bottom: 2px solid #133863;">Telefoane</h4>
                    <div class="form-check ml-5">
                        <input class="form-check-input" type="radio" name="category" id="Iphone" value="Iphone">
                        <label class="form-check-label" for="Iphone">
                            Iphone
                        </label>
                    </div>
                    <div class="form-check ml-5">
                        <input class="form-check-input" type="radio" name="category" id="Samsung" value="Samsung">
                        <label class="form-check-label" for="Samsung">
                            Samsung
                        </label>
                    </div>
                    <div class="form-check ml-5">
                        <input class="form-check-input" type="radio" name="category" id="Huawei" value="Huawei">
                        <label class="form-check-label" for="Huawei">
                            Huawei
                        </label>
                    </div>
                    <div class="form-check ml-5">
                        <input class="form-check-input" type="radio" name="category" id="Altele" value="toate" checked>
                        <label class="form-check-label" for="Altele">
                            Toate
                        </label>
                    </div>
                    </form>
                </div>
                <div class="col-lg-4 col-sm-12 mt-3 col-md-12">
                    <h4 class="mt-3 ml-5" style="border-bottom: 2px solid #133863;">Accesorii</h4>
                    <div class="form-check ml-5">
                        <input class="form-check-input" type="radio" name="category" id="Căști" value="CASTI">
                        <label class="form-check-label" for="Căști">
                            Căști
                        </label>
                    </div>
                    <div class="form-check ml-5">
                        <input class="form-check-input" type="radio" name="category" id="Baterii" value="Baterii">
                        <label class="form-check-label" for="Baterii">
                            Baterii externe
                        </label>
                    </div>
                    <div class="form-check ml-5">
                        <input class="form-check-input" type="radio" name="category" id="Cabluri" value="Cabluri">
                        <label class="form-check-label" for="Cabluri">
                            Cabluri
                        </label>
                    </div>
                    <div class="form-check ml-5">
                        <input class="form-check-input" type="radio" name="category" id="Incărcătoare" value="INCARCATOARE">
                        <label class="form-check-label" for="Incărcătoare">
                            Incărcătoare
                        </label>
                    </div>
                </div>
                <div class="col-lg-4 col-sm-12 mt-3 col-md-12">
                    <h4 class="mt-3 ml-5" style="border-bottom: 2px solid #133863;">Preț</h4>
                    <div class="d-flex  ml-5">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="pret" id="crescator" value="crescator">
                            <label class="form-check-label" for="crescator" >
                                Crescător
                            </label>
                        </div>
                        <div class="form-check ml-4">
                            <input class="form-check-input" type="radio" name="pret" id="descrescator" value="descrescator" checked>
                            <label class="form-check-label" for="descrescator">
                                Descrescător
                            </label>
                        </div>
                    </div>

                    <h4 class="mt-3 ml-5" style="border-bottom: 2px solid #133863;">Stare</h4>
                    <div class="d-flex  ml-5 " id="condition-form">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="stare" id="nou" value="nou">
                            <label class="form-check-label" for="nou" >
                                Nou
                            </label>
                        </div>
                        <div class="form-check ml-4">
                            <input class="form-check-input" type="radio" name="stare" id="utilizat" value="utilizat">
                            <label class="form-check-label" for="utilizat">
                                Utilizat
                            </label>
                        </div>
                    </div>
                   
                   
                </div>
                <div class="col-12 row">
                    <div class="col-lg-4 col-sm-6 col-md-4 mt-3 ml-3">
                            <input type="search" id="form1" class="form-control" placeholder="Caută un produs..." aria-label="Search" />
                    </div>
                </div>

            </div>
              
            <div class="d-flex justify-content-center flex-wrap" id="products">
                {%for product in products%}
                    {%if product.nou%}
                <div class="mt-5 m-3 col-lg-2 col-md-5 col-sm-4 mb-4 d-flex flex-column 
                                    justify-content-center align-items-center border border-dark selected nou" id="produs" data-position="{{forloop_counter}}">
                    <input type="hidden" id="category" value="{{product.category}}">
                    <input type="hidden" id="condition" value="{{product.nou}}">
                    <a href="#" class="waves-effect waves-light"><img src="{{product.imagine.url}}" class="mt-3 img-fluid" alt=""></a>
                    <a href="#" class="font-weight-bold black-text text-center mb-1" id="product-title">{{product.titlu}}</a>
                    <strong id="pret">{{product.pret|floatformat:2}} Lei</strong>
                </div>
                <!--Grid column-->

                    {%else%}
                        <div class="mt-5 m-3 col-lg-2 col-md-5 col-sm-4 mb-4 d-flex flex-column 
                                            justify-content-center align-items-center border border-dark selected" id="produs" data-position="{{forloop_counter}}">
                            <input type="hidden" id="category" value="{{product.category}}">
                            <input type="hidden" id="condition" value="{{product.nou}}">
                            <a href="#" class="waves-effect waves-light"><img src="{{product.imagine.url}}" class="mt-3 img-fluid" alt=""></a>
                            <a href="#" class="font-weight-bold black-text text-center mb-1" id="product-title">{{product.titlu}}</a>
                            <strong id="pret">{{product.pret|floatformat:2}} Lei</strong>
                        </div>
                        <!--Grid column-->
                    {%endif%}
     
                {%endfor%}

            </div>
            

        </div>
  
    <!--Section: Content-->


   
</div>

<script>
    $(function () {
        var inputText;
        var childrenText;
        $('#form1').on("input", function () {
            $('#products').children('div:visible').each(function () {
                inputText = $('#form1').val();
                childrenText = jQuery(this).children('#product-title').text();
                if (!childrenText.toLowerCase().includes(inputText.toLowerCase())) {
                    $(this).attr('style', 'display: none !important');
                }
            })
           if (!($('#nou').is(":checked") || $('#utilizat').is(":checked") )) {
                $('#products').children().each(function () {
                     inputText = $('#form1').val();
                     childrenText = jQuery(this).children('#product-title').text();
                     if (childrenText.toLowerCase().includes(inputText.toLowerCase()) && $(this).hasClass('selected')) {
                         $(this).show()
                     }
                 })
            }
            else{
                if ($('#nou').is(":checked")){
                    $('#products').children().each(function () {
                        inputText = $('#form1').val();
                        childrenText = jQuery(this).children('#product-title').text();
                        if (childrenText.toLowerCase().includes(inputText.toLowerCase()) && $(this).hasClass('selected') && $(this).hasClass('nou')) {
                            $(this).show()
                        }
                    })
                }
                else if($('#utilizat').is(":checked")){
                    $('#products').children().each(function () {
                        inputText = $('#form1').val();
                        childrenText = jQuery(this).children('#product-title').text();
                        if (childrenText.toLowerCase().includes(inputText.toLowerCase()) && $(this).hasClass('selected') && (!$(this).hasClass('nou'))) {
                            $(this).show()
                        }
                    })
                }
            }
        })
    })
   


    $('input[type=radio][name=category]').on('change', function () {
        $('#form1').val('');
        var radioValue = $(this).val();
        if(radioValue == 'toate'){
            $('input[type=radio][name=stare]').each(function(){
                this.checked = false;
            });
            $('#products').children().each(function(){
                $(this).addClass('selected');
                $(this).show();
            })
        }
        else{
            $('#products').children().each(function () {
                childrenCategory = jQuery(this).children('#category').val();
                if (!childrenCategory.toLowerCase().includes(radioValue.toLowerCase())) {
                    $(this).attr('style', 'display: none !important');
                    $(this).removeClass('selected');
                }
            })
            if(!( $('#nou').is(":checked") || $('#utilizat').is(":checked")  ))
            {
                  $('#products').children().each(function () {
                    childrenCategory = jQuery(this).children('#category').val();
                    if (childrenCategory.toLowerCase().includes(radioValue.toLowerCase())) {
                        $(this).addClass('selected');
                        $(this).show();
                    }
                })
            }
            else{
                if($('#nou').is(':checked'))
                {
                      $('#products').children().each(function () {
                        childrenCategory = jQuery(this).children('#category').val();

                        if ($(this).hasClass('nou') && childrenCategory.toLowerCase().includes(radioValue.toLowerCase())) {
                                $(this).addClass('selected');
                                $(this).show();
                            }

                        else if (childrenCategory.toLowerCase().includes(radioValue.toLowerCase())) {
                                $(this).addClass('selected');
                            }
                        })
                }

                
                else if($('#utilizat').is(':checked')){
                     $('#products').children().each(function () {
                        childrenCategory = jQuery(this).children('#category').val();
                         if(!$(this).hasClass('nou') && childrenCategory.toLowerCase().includes(radioValue.toLowerCase())){
                                 $(this).addClass('selected');
                                 $(this).show();
                         }
                         else if (childrenCategory.toLowerCase().includes(radioValue.toLowerCase())) {
                                 $(this).addClass('selected');
                             }
                    })
                }
              
            }
        }
    });


     $('input[type=radio][name=stare]').on('change', function () {
            $('#form1').val('');
            var radioValue = $(this).val();
            if (radioValue == 'nou'){
                 $('#products').children().each(function () {
                        if(!$(this).hasClass('nou')){
                            $(this).attr('style', 'display: none !important');
                        }
                    else if($(this).hasClass('selected')){
                        $(this).show();
                    }
                })
            }
            else{
                  $('#products').children().each(function () {
                    if ($(this).hasClass('nou')) {
                        $(this).attr('style', 'display: none !important');
                    }
                    else if ($(this).hasClass('selected')){
                        $(this).show();
                    }
                })
            }
        });


   
 
    
    $('input[type=radio][name=pret]').on('change', function () {
        var radioValue = $(this).val();
        console.log(radioValue);
        if (radioValue == 'crescator'){
            $('#descrescator').prop("checked", false);
        }
        else if (radioValue == 'descrescator') {
            $('#crescator').prop("checked", false);
        }


        
      $("#products div").sort(sort_el) // sort elements
            .appendTo('#products'); // append again to the list
        // sort function callback
        function sort_el(a, b) {
            return ($(b).data('position')) < ($(a).data('position')) ? 1 : -1;
        }
    });
   
</script>



{%endblock%}